{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "post_invoice_data_trip_wise",
    "datasource": {
      "name": "Postgres_latest",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Postgres_latest",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "Total Bill Invoice Creation",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "WITH data(\n    serial_for_challan, fleet_id, fleet_tracking_id, required_date, payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, vat, ait, truck_price_with_ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, additional_fee_remarks, status, truck_price_ait_evat, truck_price_remarks, additional_fee_ait_evat)\n AS (\n    VALUES\n          {{Table2.selectedRows.map((a,i)=>\"(\" + \n\t\t\t\t\t\t(i+1)+\",\"+\n\t\t\t\t\t\ta.id+\",'\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\n\t\t\t\t\t\tmoment(a.fleet_requested_at).format('YYYY-MM-DD')+\"','\"+\n\t\t\t\t\t\ta.payment_method+\"',\"+\n\t\t\t\t\t\ta.shop_ID+\",'\"+\n\t\t\t\t\t\ta.shop_name.replace(\"'\",\"\") +\"','\"+\n\t\t\t\t\t\ta.challanNumber+\"','\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\t\t\t\t\t\t\n\t\t\t\t\t\ta.vehicle_number+\"','\"+\n\t\t\t\t\t\ta.load_point.replace(\"'\",\"\") +\"','\"+\n\t\t\t\t\t\ta.unload_point.replace(\"'\",\"\")+\"',\"+\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t \ta.base_fare+\",\"+\n\t\t\t\t\t\ta.demurrage_fee+\",\"+\n\t\t\t\t\t\ta.total_truck_price+\",\"+\n\t\t\t\t\t  a.calculated_VAT+\",\"+\n\t\t\t\t\t\ta.calculated_AIT+\",\"+\n\t\t\t\t\t\ta.base_fare_ait+\",\"+\n\t\t\t\t\t  a.spread+\",\"+\n            a.transport_team_rate+\",\"+\n\t\t\t\t\t\ta.collectible+\",\"+\n\t\t\t\t\t\ta.total_price_after_vat_ait+\",'\"+\n\t\t\t\t\t\ta.demurrage_remarks+\"','\"+\n\t\t\t\t\t\t'Ready-to-send' +\"',\"+\n\t\t\t\t\t\ta.base_fare_ait+\",'\"+\n\t\t\t\t\t\ta.truckPriceRemarks.replace(\":\",\"\")+\"',\"+\n\t\t\t\t\t\ta.additional_fee_AIT+\n\t\t\t\t\t\t\")\").join()}}\n),\nins_finance_trip_invoices AS (\n    INSERT INTO\n        finance_trip_invoices (\n            invoice_number, trip_counts, trip_total_revenue, client_name, trip_month, vat, ait, spread, sourcing_cost, banner, columns_to_print, status, collectable, total_price_after_vat_ait, shop_id,vat_rate,sd_rate,user_data\n        )\n        select {{\"'\"+InvoiceNumber.text+\"'\"}}, {{parseInt(Table2.selectedRows.length)}}, {{parseInt(totalRevenueToInvoice.text)}}, {{\"'\"+clientNameInvoice.text.replace(\"'\",\"\") +\"'\"}}, {{\"'\"+tripMonthInvoice.text+\"'\"}},{{vatModal.text}},{{aitModal.text}},{{spreadModal.text}},{{totalCostToInvoice.text}}, {{\"'\"+Input2.text+\"'\"}},\n\t{{\"'\"+ columns_to_print.text +\"'\"}}, 'Ready-to-send', {{totalCollectable.text}}, {{totalAfterVatAitModal.text}}, {{shopIdInvoice.text}}, {{vatRate.text.replace('%','')}}, {{aitRate.text}},{{\"'\"+appsmith.store.user_data+\"'\"}}\n\tRETURNING invoice_number, id\n)\nINSERT INTO\n        trip_level_invoice (\n            fleet_id, fleet_tracking_id, required_date, payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, invoice_number, vat, ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, serial_for_challan, additional_fee_remarks, status,truck_price_with_ait, truck_price_ait_evat, truck_price_remarks, additional_fee_ait_evat, finance_trip_invoice_id\n        )\n    SELECT\n        fleet_id, fleet_tracking_id, cast(required_date as timestamp), payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, (select invoice_number from ins_finance_trip_invoices), vat, ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, serial_for_challan, additional_fee_remarks, status, truck_price_with_ait, truck_price_ait_evat,truck_price_remarks, additional_fee_ait_evat, (select id from ins_finance_trip_invoices)\n    FROM\n        data ",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ]
    },
    "executeOnLoad": false,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "\"'\"+ columns_to_print.text +\"'\"",
      "\"'\"+Input2.text+\"'\"",
      "\"'\"+InvoiceNumber.text+\"'\"",
      "\"'\"+appsmith.store.user_data+\"'\"",
      "\"'\"+clientNameInvoice.text.replace(\"'\",\"\") +\"'\"",
      "\"'\"+tripMonthInvoice.text+\"'\"",
      "Table2.selectedRows.map((a,i)=>\"(\" + \n\t\t\t\t\t\t(i+1)+\",\"+\n\t\t\t\t\t\ta.id+\",'\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\n\t\t\t\t\t\tmoment(a.fleet_requested_at).format('YYYY-MM-DD')+\"','\"+\n\t\t\t\t\t\ta.payment_method+\"',\"+\n\t\t\t\t\t\ta.shop_ID+\",'\"+\n\t\t\t\t\t\ta.shop_name.replace(\"'\",\"\") +\"','\"+\n\t\t\t\t\t\ta.challanNumber+\"','\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\t\t\t\t\t\t\n\t\t\t\t\t\ta.vehicle_number+\"','\"+\n\t\t\t\t\t\ta.load_point.replace(\"'\",\"\") +\"','\"+\n\t\t\t\t\t\ta.unload_point.replace(\"'\",\"\")+\"',\"+\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t \ta.base_fare+\",\"+\n\t\t\t\t\t\ta.demurrage_fee+\",\"+\n\t\t\t\t\t\ta.total_truck_price+\",\"+\n\t\t\t\t\t  a.calculated_VAT+\",\"+\n\t\t\t\t\t\ta.calculated_AIT+\",\"+\n\t\t\t\t\t\ta.base_fare_ait+\",\"+\n\t\t\t\t\t  a.spread+\",\"+\n            a.transport_team_rate+\",\"+\n\t\t\t\t\t\ta.collectible+\",\"+\n\t\t\t\t\t\ta.total_price_after_vat_ait+\",'\"+\n\t\t\t\t\t\ta.demurrage_remarks+\"','\"+\n\t\t\t\t\t\t'Ready-to-send' +\"',\"+\n\t\t\t\t\t\ta.base_fare_ait+\",'\"+\n\t\t\t\t\t\ta.truckPriceRemarks.replace(\":\",\"\")+\"',\"+\n\t\t\t\t\t\ta.additional_fee_AIT+\n\t\t\t\t\t\t\")\").join()",
      "aitModal.text",
      "aitRate.text",
      "parseInt(Table2.selectedRows.length)",
      "parseInt(totalRevenueToInvoice.text)",
      "shopIdInvoice.text",
      "spreadModal.text",
      "totalAfterVatAitModal.text",
      "totalCollectable.text",
      "totalCostToInvoice.text",
      "vatModal.text",
      "vatRate.text.replace('%','')"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "Total Bill Invoice Creation_post_invoice_data_trip_wise",
  "deleted": false,
  "gitSyncId": "6231701cf1c0af1ceded5043_634f82b75f559f5079c6d7cc"
}
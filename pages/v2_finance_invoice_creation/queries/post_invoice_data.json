{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "post_invoice_data",
    "datasource": {
      "name": "Postgres_latest",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Postgres_latest",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "v2_finance_invoice_creation",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "WITH data(\n    serial_for_challan, fleet_id, fleet_tracking_id, required_date, payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, vat, ait, truck_price_with_ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, additional_fee_remarks, status, truck_price_ait_evat, additional_fee_ait_evat)\n AS (\n    VALUES\n          {{Table1.selectedRows.map((a,i)=>\"(\" + \n\t\t\t\t\t\t(i+1)+\",\"+\n\t\t\t\t\t\ta.id+\",'\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\n\t\t\t\t\t\ta.fleet_requested_at+\"','\"+\n\t\t\t\t\t\ta.payment_method+\"',\"+\n\t\t\t\t\t\ta.shop_ID+\",'\"+\n\t\t\t\t\t\ta.shop_name +\"','\"+\n\t\t\t\t\t\ta.challanNumber+\"','\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\t\t\t\t\t\t\n\t\t\t\t\t\ta.vehicle_number+\"','\"+\n\t\t\t\t\t\ta.load_point.replace(\"'\",\"\") +\"','\"+\n\t\t\t\t\t\ta.unload_point.replace(\"'\",\"\")+\"',\"+\n\t\t\t\t\t \ta.truck_price+\",\"+\n\t\t\t\t\t\ta.demurrage_fee+\",\"+\n\t\t\t\t\t\ta.total_truck_price+\",\"+\n\t\t\t\t\t  a.calculated_VAT+\",\"+\n\t\t\t\t\t\ta.calculated_AIT+\",\"+\n\t\t\t\t\t\ta.truck_price_ait+\",\"+\n\t\t\t\t\t\ta.spread+\",\"+\n            a.transport_team_rate+\",\"+\n\t\t\t\t\t\ta.collectible+\",\"+\n\t\t\t\t\t\ta.total_price_after_vat_ait+\",'\"+\n\t\t\t\t\t\ta.demurrage_remarks+\"','\"+\n\t\t\t\t\t\t'Ready-to-send' +\"',\"+\n\t\t\t\t\t\ta.truck_price_ait+\",\"+\n\t\t\t\t\t\ta.additional_fee_AIT+\n\t\t\t\t\t\t\")\").join()}}\n),\nins_finance_trip_invoices AS (\n    INSERT INTO\n        finance_trip_invoices (\n            invoice_number, trip_counts, trip_total_revenue, client_name, trip_month, vat, ait, spread, sourcing_cost, banner, columns_to_print, status, collectable, total_price_after_vat_ait, shop_id,vat_rate,sd_rate,user_data\n        )\n        select {{\"'\"+InvoiceNumberCopy.text+\"'\"}}, {{parseInt(totalTripToInvoiceCopy.text)}}, {{parseInt(totalRevenueToInvoiceCopy.text)}}, {{\"'\"+clientNameInvoiceCopy.text+\"'\"}}, {{\"'\"+tripMonthInvoiceCopy.text+\"'\"}},{{vatModalCopy.text}},{{aitModalCopy.text}},{{spreadModalCopy.text}},{{totalCostToInvoiceCopy.text}}, {{\"'\"+Input2Copy.text+\"'\"}},\n\t{{\"'\"+ Table1.selectedRow.Comma_Seperated_Column +\"'\"}}, 'Ready-to-send', {{totalCollectableCopy.text}}, {{totalAfterVatAitModalCopy.text}}, {{shopIdInvoiceCopy.text}}, {{vatRateCopy.text}}, {{aitRateCopy.text}},{{\"'\"+appsmith.store.user_data+\"'\"}}\n\tRETURNING invoice_number\n)\nINSERT INTO\n        trip_invoices_collection (\n            fleet_id, fleet_tracking_id, required_date, payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, invoice_number, vat, ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, serial_for_challan, additional_fee_remarks, status,truck_price_with_ait, truck_price_ait_evat, additional_fee_ait_evat\n        )\n    SELECT\n        fleet_id, fleet_tracking_id, cast(required_date as timestamp), payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, (select invoice_number from ins_finance_trip_invoices), vat, ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, serial_for_challan, additional_fee_remarks, status, truck_price_with_ait, truck_price_ait_evat, additional_fee_ait_evat\n    FROM\n        data ",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ]
    },
    "executeOnLoad": false,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "\"'\"+ Table1.selectedRow.Comma_Seperated_Column +\"'\"",
      "\"'\"+Input2Copy.text+\"'\"",
      "\"'\"+InvoiceNumberCopy.text+\"'\"",
      "\"'\"+appsmith.store.user_data+\"'\"",
      "\"'\"+clientNameInvoiceCopy.text+\"'\"",
      "\"'\"+tripMonthInvoiceCopy.text+\"'\"",
      "Table1.selectedRows.map((a,i)=>\"(\" + \n\t\t\t\t\t\t(i+1)+\",\"+\n\t\t\t\t\t\ta.id+\",'\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\n\t\t\t\t\t\ta.fleet_requested_at+\"','\"+\n\t\t\t\t\t\ta.payment_method+\"',\"+\n\t\t\t\t\t\ta.shop_ID+\",'\"+\n\t\t\t\t\t\ta.shop_name +\"','\"+\n\t\t\t\t\t\ta.challanNumber+\"','\"+\n\t\t\t\t\t\ta.tracking_id+\"','\"+\t\t\t\t\t\t\n\t\t\t\t\t\ta.vehicle_number+\"','\"+\n\t\t\t\t\t\ta.load_point.replace(\"'\",\"\") +\"','\"+\n\t\t\t\t\t\ta.unload_point.replace(\"'\",\"\")+\"',\"+\n\t\t\t\t\t \ta.truck_price+\",\"+\n\t\t\t\t\t\ta.demurrage_fee+\",\"+\n\t\t\t\t\t\ta.total_truck_price+\",\"+\n\t\t\t\t\t  a.calculated_VAT+\",\"+\n\t\t\t\t\t\ta.calculated_AIT+\",\"+\n\t\t\t\t\t\ta.truck_price_ait+\",\"+\n\t\t\t\t\t\ta.spread+\",\"+\n            a.transport_team_rate+\",\"+\n\t\t\t\t\t\ta.collectible+\",\"+\n\t\t\t\t\t\ta.total_price_after_vat_ait+\",'\"+\n\t\t\t\t\t\ta.demurrage_remarks+\"','\"+\n\t\t\t\t\t\t'Ready-to-send' +\"',\"+\n\t\t\t\t\t\ta.truck_price_ait+\",\"+\n\t\t\t\t\t\ta.additional_fee_AIT+\n\t\t\t\t\t\t\")\").join()",
      "aitModalCopy.text",
      "aitRateCopy.text",
      "parseInt(totalRevenueToInvoiceCopy.text)",
      "parseInt(totalTripToInvoiceCopy.text)",
      "shopIdInvoiceCopy.text",
      "spreadModalCopy.text",
      "totalAfterVatAitModalCopy.text",
      "totalCollectableCopy.text",
      "totalCostToInvoiceCopy.text",
      "vatModalCopy.text",
      "vatRateCopy.text"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "v2_finance_invoice_creation_post_invoice_data",
  "deleted": false,
  "gitSyncId": "6231701cf1c0af1ceded5043_631307c59316f9675669b433"
}
{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "post_invoice_data",
    "datasource": {
      "name": "Postgres_latest",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Postgres_latest",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "v1_finance_invoice_creation",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "WITH data(\n    serial_for_challan, fleet_id, fleet_tracking_id, required_date, payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, vat, ait, truck_price_with_ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, additional_fee_remarks, status, truck_price_ait_evat, additional_fee_ait_evat)\n AS (\n    VALUES\n          {{invoiceTbl.selectedRows.map((a,i)=>\"(\" + \n\t\t\t\t\t\t(i+1)+\",\"+\n\t\t\t\t\t\ta.id+\",'\"+\n\t\t\t\t\t\ta.fleetTrackingId+\"','\"+\n\t\t\t\t\t\ta.requiredDate+\"','\"+\n\t\t\t\t\t\ta.customColumn9+\"',\"+\n\t\t\t\t\t\ta.customColumn6+\",'\"+\n\t\t\t\t\t\ta.shopDetails.replace(\"'\", \"''\")+\"','\"+\n\t\t\t\t\t\ta.customColumn13+\"','\"+\n\t\t\t\t\t\ta.customColumn14+\"','\"+\t\t\t\t\t\t\n\t\t\t\t\t\ta.vehicleNumber+\"','\"+\n\t\t\t\t\t\ta.customColumn4.replace(\"'\", \"''\")+\"','\"+\n\t\t\t\t\t\ta.fleetpoints.replace(\"'\", \"''\")+\"',\"+\n\t\t\t\t\t \ta.consignment+\",\"+\n\t\t\t\t\t\ta.customColumn11+\",\"+\n\t\t\t\t\t\ta.customColumn12+\",\"+\n\t\t\t\t\t  a.customColumn21+\",\"+\n\t\t\t\t\t\ta.customColumn24+\",\"+\n\t\t\t\t\t\t(a.customColumn12+a.customColumn24)+\",\"+\n\t\t\t\t\t\ta.customColumn18+\",\"+\n            a.customColumn27+\",\"+\n\t\t\t\t\t\ta.customColumn29+\",\"+\n\t\t\t\t\t\ta.customColumn30+\",'\"+\n\t\t\t\t\t\ta.customColumn23+\"','\"+\n\t\t\t\t\t\t'Ready-to-send' +\"',\"+\n\t\t\t\t\t\ta.customColumn33+\",\"+\n\t\t\t\t\t\ta.customColumn34+\n\t\t\t\t\t\t\")\").join()}}\n),\nins_finance_trip_invoices AS (\n    INSERT INTO\n        finance_trip_invoices (\n            invoice_number, trip_counts, trip_total_revenue, client_name, trip_month, vat, ait, spread, sourcing_cost, banner, columns_to_print, status, collectable, total_price_after_vat_ait, shop_id,vat_rate,sd_rate,user_data\n        )\n        select {{\"'\"+InvoiceNumber.text+\"'\"}}, {{parseInt(totalTripToInvoice.text)}}, {{parseInt(totalRevenueToInvoice.text)}}, {{\"'\"+clientNameInvoice.text+\"'\"}}, {{\"'\"+tripMonthInvoice.text+\"'\"}},{{vatModal.text}},{{aitModal.text}},{{spreadModal.text}},{{totalCostToInvoice.text}}, {{\"'\"+SelectBannerDropDown.selectedOptionLabel+\"'\"}},\n\t{{\"'\"+ CheckboxGroup1.selectedValues.join() +\"'\"}}, 'Ready-to-send', {{totalCollectable.text}}, {{totalAfterVatAitModal.text}}, {{shopIdInvoice.text}}, {{vatRate.text}}, {{aitRate.text}},{{\"'\"+appsmith.store.user_data+\"'\"}}\n\tRETURNING invoice_number\n)\nINSERT INTO\n        trip_invoices_collection (\n            fleet_id, fleet_tracking_id, required_date, payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, invoice_number, vat, ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, serial_for_challan, additional_fee_remarks, status,truck_price_with_ait, truck_price_ait_evat, additional_fee_ait_evat\n        )\n    SELECT\n        fleet_id, fleet_tracking_id, cast(required_date as timestamp), payment_method, shop_id, shop_name, challan_number, tracking_id, vehicle_number, load_point, unload_point, truck_price, additional_fee, total_revenue, (select invoice_number from ins_finance_trip_invoices), vat, ait, spread, sourcing_cost, collectable, total_price_after_vat_ait, serial_for_challan, additional_fee_remarks, status, truck_price_with_ait, truck_price_ait_evat, additional_fee_ait_evat\n    FROM\n        data ",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ]
    },
    "executeOnLoad": false,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "\"'\"+ CheckboxGroup1.selectedValues.join() +\"'\"",
      "\"'\"+InvoiceNumber.text+\"'\"",
      "\"'\"+SelectBannerDropDown.selectedOptionLabel+\"'\"",
      "\"'\"+appsmith.store.user_data+\"'\"",
      "\"'\"+clientNameInvoice.text+\"'\"",
      "\"'\"+tripMonthInvoice.text+\"'\"",
      "aitModal.text",
      "aitRate.text",
      "invoiceTbl.selectedRows.map((a,i)=>\"(\" + \n\t\t\t\t\t\t(i+1)+\",\"+\n\t\t\t\t\t\ta.id+\",'\"+\n\t\t\t\t\t\ta.fleetTrackingId+\"','\"+\n\t\t\t\t\t\ta.requiredDate+\"','\"+\n\t\t\t\t\t\ta.customColumn9+\"',\"+\n\t\t\t\t\t\ta.customColumn6+\",'\"+\n\t\t\t\t\t\ta.shopDetails.replace(\"'\", \"''\")+\"','\"+\n\t\t\t\t\t\ta.customColumn13+\"','\"+\n\t\t\t\t\t\ta.customColumn14+\"','\"+\t\t\t\t\t\t\n\t\t\t\t\t\ta.vehicleNumber+\"','\"+\n\t\t\t\t\t\ta.customColumn4.replace(\"'\", \"''\")+\"','\"+\n\t\t\t\t\t\ta.fleetpoints.replace(\"'\", \"''\")+\"',\"+\n\t\t\t\t\t \ta.consignment+\",\"+\n\t\t\t\t\t\ta.customColumn11+\",\"+\n\t\t\t\t\t\ta.customColumn12+\",\"+\n\t\t\t\t\t  a.customColumn21+\",\"+\n\t\t\t\t\t\ta.customColumn24+\",\"+\n\t\t\t\t\t\t(a.customColumn12+a.customColumn24)+\",\"+\n\t\t\t\t\t\ta.customColumn18+\",\"+\n            a.customColumn27+\",\"+\n\t\t\t\t\t\ta.customColumn29+\",\"+\n\t\t\t\t\t\ta.customColumn30+\",'\"+\n\t\t\t\t\t\ta.customColumn23+\"','\"+\n\t\t\t\t\t\t'Ready-to-send' +\"',\"+\n\t\t\t\t\t\ta.customColumn33+\",\"+\n\t\t\t\t\t\ta.customColumn34+\n\t\t\t\t\t\t\")\").join()",
      "parseInt(totalRevenueToInvoice.text)",
      "parseInt(totalTripToInvoice.text)",
      "shopIdInvoice.text",
      "spreadModal.text",
      "totalAfterVatAitModal.text",
      "totalCollectable.text",
      "totalCostToInvoice.text",
      "vatModal.text",
      "vatRate.text"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "v1_finance_invoice_creation_post_invoice_data",
  "deleted": false,
  "gitSyncId": "6231701cf1c0af1ceded5043_63130c889316f9675669b461"
}